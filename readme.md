数据治理是对数据资产的管理活动行使权利和控制的活动集合（规划/监控和执行）

数据治理是一个体系，需要数据质量管理，元数据管理，主数据管理，模型管理，数据价值管理。


制定数据标准，从定义表命名规范，字段命名规范，数据类型，备注Comment术语描述规范，指标命名规范，指标口径定义等方面制定规范。

事前数据开发人员的提高保证数据质量意识，在ETL或ELT数据采集/转换/加载过程中，需要数据进行清洗，保证数据高质量产出。事中通过建立一套切实可行的数据质量监控体系。事后出现质量问题定位技术负责人，进行整改和迭代，保证数据质量管理形成一个良性循环，实现数据向优质资产的转变。


## 总体介绍

此数据质量监控系统是基于Spark计算框架，通过界面配置对Hive数据仓库各层表，离线批数据质量监控系统（流单独处理）。用户可以通过前端界面选择哪个数据源（哪个集群），数据库、表或表中字段，配置监控规则，存放到MySQL库，程序通过规则大类，监控规则等元数据信息，动态生成SQL片段集合，在进行优化组合，尽量减少对表读取次数，将执行结果存放在监控结果表。调度根据当前任务执行结果判断是否熔断报警。再根据执行结果形成数据质量报告。


## 功能
* 丰富可扩展数据质量监控规则库
* 自定义数据质量监控规则及语法检查
* 任务熔断、电话、短信、邮件多级告警
* 清晰定温质量问题业务和技术数据Owner
* 数据质量问题汇总与明细展示
* 监控对象表结构动态感知
* 数据质量问题订阅

系统框架图：
	* Define
		** 监控规则配置
		** 规则库
		** 数据标准库
	* Measure
		** 有效性
		** 唯一性
		** 准确性
		** 完整性
		** 一致性 
		** 时效性
		** 自定义
	* Analyze
		** 数据质量报告
		** 质量改进进化
		** 报告订阅
		** 并更通知

数据质量监控执行流程图
开始 --》 启动监控任务 --〉 读取规则配置信息 --》 执行Spark监控任务 --〉 质量核查结果 --》 指标是否异常 --〉 数据质量报告

表结构设计
1、监控任务与监控对象表的对应关系
说明：
source_id: 指定对哪个集群数据进行质量监控
databaseName： 指定数据库名称
table_name: 指定数据表名称
owner： 数据owner，表创建人，是从Hivemeta元数据中获得

2、监控规则配置表
说明：
task_id : 即上一张表id，调度时使用
databaseName： 指定数据库名称
table_name: 指定数据表名称
part_flag: 是否为分区表标志
part——formart ： 分区格式
task——desc： 用户对此条监控规则的描述
rule——name： 监控规则大分类，如有效性、唯一性、准确性等等
term： 具体监控指标名称
field——name： 监控字段，如果是表级别，则天蝎表级别规则， 或自定义SQL规则
warn——grad： 告警级别： 1/熔断电话报警， 2、电话告警 3、邮件告警
rule——logic-monitor： 监控规则，需要配置逻辑信息，是个json字符串，程序执行对json的key进行解析
data-owner： 数据owner
is-usable： 此条规则是否可用，前端配置人员可以起停规则

3、监控规则库表
说明：
rule——name： 监控规则大分类，如有效性，一致性、唯一性、准确性等等
rule-desc： 规则大类的说明
term： 具体的监控指标名称
term-desc： 规则说明
logic-remark： 监控规则的详细说明
term-lever： 规则级别，字段级别，比噢级别或自定义SQL规则
datatype-scope： 此条监控规则的是否范围，比如： 同比波动检测，只能数值型字段
state： 是否可用

4、监控规则元数据表
说明：
rule——name： 监控规则大分类，如有效性，唯一性，准确性等等
term： 具体的监控指标名称
param——name： 参数名称，为rule——logic-monitor 监控规则，需要配置逻辑信息，是个json字符串，程序执行对json的key进行解析
param-desc： 界面展示
value——type： 界面输入框还是下拉框等说明
constrints： 界面输入框输入内容限制，正则表达式
param——weight： 界面参数展示顺序

5、监控结果表
说明：
task——id： 任务id
uuid：调用的批次
databaseName： 指定数据库名称
table——name： 指定表名称
rule——name： 监控规则大分类，如有效性/唯一性/准确性等
term： 具体的监控指标名称
field_name: 监控字段，如果是表级别，则填写表规则 或 自定义SQL规则
term——value： 监控结果值， result——code： 结果返回值，配合告警一起使用
warn——grad： 告警级别： 1/熔断电话报警， 2、电话告警 3、邮件告警






规则指标：

数据质量监控指标从有效性、唯一性、完整性、准确性、一致性、有效性和自定义监控规则八大类，约20条监控规则指标。 以下对各个监控指标作出的解释

* 有效性
  * 字段长度有效
  对字段内容长度是否在有效性范围的监控指标， 可配置 最小长度、最大长度、。 如mobile手机号11位，身份证18位或者15位是否满足配置监控长度，不等于配置长度范围，是为藏数据

  * 字段内容有效
  对字段内容是否满足正则表达式指定内容的监控指标。 如对name中含有中英文结合，身份证号中包含中文，手机号1111111111等异常数据

  * 字段数值范围有效
  对数值类型字段是否在有效值范围的监控指标，可根据业务场景配置该字段值范围（最大值、最小值）。 如age年龄，超过1000岁等

  * 枚举值个数有效
  对枚举值字段的课枚举种类个数的监控指标可配置 》 《  >= <= != 与期望值的比较。 如银行储值卡在 消费/转账、体现三种业务类型，枚举值个数某天少一种或多种业务类型，可能是上有数据系统出现问题，或数据采集时丢失数据。


  * 枚举值集合有效
  枚举值内容发生错误

  * 唯一性
  是否重复， 对主键是否存在重复数据的监控指标。出现重复数据导致重复计算等问题，也支持联合主键唯一性监控

  * 完整性
     * 字段是否位空或NULL
       对字段内容是否存在NULL的监控指标
     * 记录数是否丢失
       表级别质量监控指标，判断是否记录丢失或无数据， 🉑️配置 > >= < <= != 与期望值的比较
     * 记录数环比波动
       表级别质量监控指标，判断记录数环比波动范围的指标监控， 如可配置 最小波动值、最大波动值 可接受记录数波动范围
     * 记录数方差检验
       表级质量监控指标，判断记录数房产检验波动防伪的指标监控，如可配置 最小波动值、最大波动值 可接受记录数波动范围
 * 准确性
     * 数据同比波动检测
       对数值类型字段值同比年、季度或者约是否在波动范围内的指标监控。 可配置 最小波动值、最大波动值 可接受记录数波动范围。 一般用于报表指标等监控。
     * 数值环比波动检测
     * 数值方差波动检验
     * 表逻辑检查
       表级别质量监控指标， 对表两个字段存在逻辑关系是否准确的监控指标。 如信用卡当前剩余可用额度<= 此次消费金额
 * 一致性
     * 表级别一致性检查
       表级别质量监控指标，根据提前定义的数据标准， 基础元数据字段名吗规范，术语命名规则， 字段comment规范、数据类型规范； 指标元数据字段命名规范， 术语命名规范、 字段comment规范， 数据类型规范， 计算口径是否统一等规范。 对表结构字段、字段comment、数据类型等是否一致的监控检查。
     * 交叉验证
       表级别质量监控指标，判断两张表的主题对象是否一致。
 * 时效性
     * 数据是否准时产出
       表级别质量监控指标，数据是否按时阐述。 如用于决策的报表是否零担们上班前准时看到无误的数据。
     * 数据刨析
       最大值检查
       最小值检查
       平均值检查
       汇总值检查

 * 自定义值检查
     * 自定义SQL规则
       用户写自定义SQL实现的监控规则，但这段SQL结果必须一行一列的值


## 表结构变更动态感知
    当对某张表或字段配置完监控规则后，表删除或表结构发生了变更，因为程序对监控规则做组合优化的，不能一个字段的变更到此张表的所有规则失效或报错。 在这种情况下，实现了表结构变更的动态感知，吧涉及到变更字段的监控规则值为无效，并发出通知。

    技术实现是使用Antlr4解析做的，利用Spark词法文件，生成词法分析器，语法分析器，抽象语法树。 利用Antlr4访问者模式遍历语法书，收集这段SQL中用到库、表、字段集合与HiveMeta元数据库、表、字段集合比较， 如果此表的HiveMeta元数据集合不能包含监控规则关于元数据集合，将此规则值为无效 

